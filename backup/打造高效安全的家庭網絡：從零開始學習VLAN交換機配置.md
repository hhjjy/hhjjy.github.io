# 什麼是VLAN？ 
VLAN，全名為虛擬區域網（Virtual Local Area Network），是一種網絡分割技術，可以讓不同網絡區域之間彼此隔離，提升安全性和管理靈活性。透過VLAN，我們可以將同一個物理網絡劃分成多個虛擬網絡，每個虛擬網絡內的設備可以互相通信，但不同虛擬網絡間的設備則需要透過路由器或防火牆來進行通信，這樣能有效防止未經授權的訪問，提升整體網絡的安全性。

# 為什麼交換機需要用VLAN？
VLAN 提供了以下幾個主要優勢：
1. 安全性：不同的 VLAN 之間彼此隔離，可以防止未經授權的訪問和數據泄露。
2. 性能：通過劃分 VLAN，可以減少廣播域的範圍，從而減少廣播風暴對整體網絡性能的影響。
3. 管理靈活性：VLAN 使得網絡管理更加靈活，可以根據實際需要快速調整網絡結構，而無需物理上重新佈線。
4. 節省成本：通過劃分 VLAN，可以在同一套物理設備上運行多個邏輯網絡，節省了硬體設備的投入。

以下面這張圖為例，如果要搭建這樣的隔離網路，我們需要一台路由、兩台交換機，然而如果使用VLAN交換機，我們可以直接在交換機上搭建出這樣的結構，同時可以快速的調整網路結構。
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/2e13d2c5-b10e-40a5-a9e1-f91754154e62)

# VLAN大致上分為...
 - MTU VLAN (Multi-Tenant Unit VLAN)
    - 特點：這種配置提高了安全性，因為它防止了同一物理網絡內的用戶或租戶直接訪問彼此的設備。每個端口好像連接到了一個獨立的網絡。
    - 應用：常用於需要嚴格數據隔離的租戶環境，例如在提供ISP服務的公寓樓或共享辦公空間中非常有用。
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/6bfca0ee-5f69-46ee-b5a4-6296551b0b83)
  
  - Port Based VLAN 
    - 定義：PORT VLAN，也稱為Port-Based VLAN，指的是基於交換機的端口來分配VLAN。在這種配置中，一個端口被指定到一個VLAN，該端口上的所有進出數據都會被限制在該VLAN中。
    - 特點：此類型的VLAN配置比較簡單，因為它僅需要管理端口與VLAN之間的關聯。一旦端口被分配到一個特定的VLAN，通過該端口的所有數據包都會被限制在這個VLAN內。
    - 應用：適用於規模較小或管理需求較簡單的網絡，其中網絡設備和連接點較少，變動不大。
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/c0ea0159-c93c-4adf-9d5e-d10b3eb7b51b)
  - 802.1Q Vlan & PVID setting 
    - 定義：802.1Q是一種VLAN的實現標準，允許在同一個物理介質上傳輸多個虛擬局域網的數據。通過在添加一個標籤（tag）來識別不同的VLAN。這個標籤包含了VLAN的識別碼（VLAN ID）。
    - 特點：802.1Q提供了更大的靈活性和擴展性。允許多個VLAN共用同一台交換機，可以跨VLAN之間的路由。
    - 應用：適合於較大的企業網絡或需要復雜網絡設計的場合，其中網絡設備需要處理來自不同VLAN的數據，或者需要實現跨VLAN通信。
    
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/ced3b540-9263-442d-8819-7383702b88d2)

## 802.1Q 知識
### PVID & VLAN ID
1. PVID（Port VLAN ID）：交換機端口的默認 VLAN ID，用於標記未標籤封包進入交換機時應該屬於哪個 VLAN。
2. VLAN ID：封包的標識，用於區分不同的 VLAN。
### Trunk 口 (Tagged)
1. 定義：Trunk 口用於在交換機之間傳輸多個 VLAN 的數據。Trunk 口會為每個封包添加一個 802.1Q 標籤，以標識其所屬的 VLAN。這個口傳輸、接收都是"有加過標籤"。
2. 應用：用於連接多個交換機或連接到支持多個 VLAN 的路由器、軟路由。
### Access 口  (untagged )
1. 定義：Access 口用於連接終端設備（如電腦或打印機）。每個 Access 口只能屬於一個 VLAN，不會對封包添加 802.1Q 標籤。這些設備只能傳送、接收"未加標籤"的封包。    
2. 應用：用於連接單個設備到交換機。
### 整合知識:

1.  VLAN 1 是預設虛擬網路：包含所有端口，所有端口都被設定成 Untagged。例如，如果 Port 1 的 PVID 設定成 1，它可以把 Port 1 的封包傳送給其他 1-8 的端口。通常會用於默認配置。通常Trunk 口都會PVID 設定成1。
3. Tagged (Trunk) 口的應用：在每個虛擬網路中，如果要互相連接，Tagged (Trunk) 口通常用於連接到軟路由或路由器的接口。只有被設定成 Tagged 的接口才能從軟體設定中提取出正確的 VLAN ID。如果在交換機網路將軟路由接口設定了Untagged，即使軟體配置正確，因為接口是 Untagged 的，所以 VLAN ID 不會被加到傳送給軟路由的封包中，自然也無法解析出其他網路傳送的VLAN ID 進而管控流量了。
4. Untagged 口應用：在虛擬網路中，如果設備需要互相連接，可以把這些端口設定成 Untagged，這樣相同的 Untagged 端口可以直接互相傳送資料（類似於區域網路的概念）。通常，我們將 Untagged 端口的 PVID 設定成該虛擬網路的 VLAN ID，這意味著該接口會默認將封包傳送到該虛擬網路內。

# 範例1: 多個租戶共用同個網路
  MTU VLAN配置，其中交換機的Uplink端口（Port 1）連接到ISP的路由器，而其他端口分別連接到不同的租客路由器（租客A和租客B）。這種配置確保了租客間的數據隔離，同時每個租客都可以訪問ISP提供的網際網路服務。
網路結構
![whiteboard_exported_image (3)](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/fb75e72c-2783-4031-9f78-6c92d1cf994f)
## 網絡配置詳細說明
  - ISP路由器(192.168.0.1)
    - 負責提供網際網路連接給整個網絡。
  - VLAN交換機(192.168.0.80)
    - Uplink端口（Port 1）被設定為連接ISP路由器。
    - 使用MTU VLAN模式確保每個端口的數據流都是隔離的，每個端口只能通過Uplink端口與外界通信。
    - 透過這個IP可以直接修改端口配置。
  - 租客A路由器(192.168.0.2)
    - 通過一個專屬的交換機端口連接，保證與租客B的數據流完全隔離。
  - 租客B路由器(192.168.0.3)
    - 同樣通過一個獨立的交換機端口連接，確保數據隔離。
## 數據流與安全性
  在這個配置中，租客A和租客B不能直接通信。他們的所有數據流只能通過ISP路由器，增加了網絡的安全性。
# 範例2: 家庭/伺服器混合網路

目前的家庭網路不夠好，大部分的頻寬都浪費掉了，新的架構要可以滿足家庭儲存資料、架設簡單伺服器（公司也可以用）、VPN遠端連線回家工作（安全比直接開Port Forwarding 好），同時實現網絡隔離。

## 目標
    1. 提升網絡性能：優化網絡結構，提升整體網速和穩定性。
    2. 數據存儲：設置家庭NAS，滿足家庭成員的數據存儲需求。
    3. 伺服器架設：設置簡單伺服器，用於家庭和公司應用。
    4. 安全的遠程訪問：設置VPN，確保遠程訪問的安全性，避免使用不安全的Port Forwarding。
    6. 網絡隔離：通過VLAN劃分不同的網絡區域，提升安全性和管理靈活性。
## VLAN拓樸結構圖/實際VLAN部署接線圖
我們要實現是下面這種拓樸結構，透過802.1Q協定讓交換機幫我們在幫我們實現。    
這個方案使用VLAN是可以符合絕大多數電腦搭建軟路由只要有單網口即可，優點是成本低、簡單易實現，缺點是硬體設備有限管控的區域網路的速度受限。
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/67a8743f-b5a7-4bc6-8f43-6ff8ba6b1695)
實際部署的考量(包含軟體)
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/e956ba5a-a14b-4568-8301-18c203b1aee4)

## 交換機設定
### 虛擬網路
在設定那些網路在同個網路ID時，大概有一個準則可以參考。網路口不能被設定的設定成Untagged。例如電腦、電視。你希望插上去就要可以用。希望有多個網路可以經過的口要設定成Tagged，因為要處理來自其他端口的資料需要"已標記"的封包才能判斷是從哪來要往哪邊發。
下面的VLAN10 舉例
- Port 1 ISP => 希望可以直通到Port 3 (untagged )
- Port 2 軟路由 => 需要匯集來自Port 1 , 3 的資料 (Tagged) 
- Port 3 Deco Mesh WIFI => 希望可以直通到Port 1 (Untagged)
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/231e1fc4-ed55-402f-ad7b-8abe690e4550)
### PVID 設定
> [!NOTE]
> 對於需要處理多個端口數據的軟路由，PVID要設定成1，原因是軟路由要能夠訪問所有端口，PVID為1 默認所有端口都在VLAN1 內 為 untagged 。

> [!NOTE]
> 對於不須加標籤的端口，PVID 通常都是設定成該網路的ID，原因是該端口發的封包要默認傳給該虛擬網路。例如VLAN10 的Port 3，PVID = 10，原因是他的網路設計時屬於VLAN10，這樣Port 2 在解析來自Port 3 封包才會認出他屬於VLAN10中。

![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/97db2925-4c86-467c-8235-ee46ff5f5f55)
## 數據流與安全性
在這個配置中，可以通過軟路由靈活設定防火牆，在達到隔離效果的同時又能兼顧靈活性，打開部分通道讓家庭網路可以直接訪問伺服器網路。可以避免伺服器網路被入侵時其他設備遭殃。

下一篇文章: 教你如何配置軟路由在VLAN網路內 #4 
    
    

