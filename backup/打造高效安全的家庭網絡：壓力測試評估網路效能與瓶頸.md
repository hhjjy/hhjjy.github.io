# 打造高效安全的家庭網絡：壓力測試評估網路效能與瓶頸

## 引言

在上一篇文章《打造高效安全的家庭網絡：從零開始學習單臂軟路由配置》中，我們介紹了如何搭建家庭網絡和伺服器網絡，通過單臂路由和虛擬網路實現網絡隔離。本文將進一步探討該網絡架構的效能，通過壓力測試來評估其性能與潛在瓶頸。

## 網路架構回顧

在進行網絡效能測試之前，讓我們簡單回顧一下當前的網絡架構：
![image](https://github.com/hhjjy/hhjjy.github.io/assets/45664168/dd35ba1d-5bab-4cb7-8009-34f7ab4dfd79)

- 192.168.0.x (ISP LAN)
  - 192.168.0.1 (ISP 路由器)
  - 192.168.0.79 (軟路由)
    - 192.168.20.1 (家庭網絡)
    - 192.168.30.1 (伺服器網絡)

### 設備和配置

1. ISP 路由器（192.168.0.1）：提供與外部網絡的連接。
2. 軟路由（192.168.0.79）：使用單臂路由技術進行內部分網。
   - 家庭網絡（192.168.20.1）：家庭內部設備的網絡。
   - 伺服器網絡（192.168.30.1）：伺服器和關鍵設備的網絡。

### 優點和缺點

#### 優點

- 成本低：不需要額外的硬件，只需配置現有的網絡設備。
- 靈活性高：可以在任何只有單網口的機器上實現。
- 可管控性強：通過軟路由和交換機可以細緻控制虛擬網絡的訪問權限和流量。

#### 缺點

- 性能瓶頸：由於是單網口實現多個區域網絡，一旦虛擬區域網絡設備的流量變大，網絡速度可能會下降。

## 測試目標

本次測試的主要目標是評估以下三個方面的網絡效能：

1. 家庭網絡與ISP LAN的傳輸速度 (192.168.0.100 -> 192.168.20.100)
2. 家庭網絡與伺服器網絡的傳輸速度 (192.168.30.101 -> 192.168.20.100)
3. 虛擬區域網路內互相的傳輸速度 (192.168.20.101 -> 192.168.20.100)

## 測試方法

測試將使用iperf3工具進行，樹莓派掛在家庭網絡下的192.168.20.100，並在此設備上運行iperf3 -s來作為服務器。測試的電腦(客戶端)分別在ISP LAN、伺服器網絡、家庭網絡下進行測試。以下是具體的測試步驟和命令：
### 伺服器端
伺服器端處於被動模式，它會等待客戶端的連接請求並響應測試數據。伺服器本身不主動發起數據傳輸，而是響應從客戶端來的請求。

```bash
iperf3 -s 
```

### 客戶端
客戶端是通過運行iperf3 -c <server_ip>命令來啟動的，-c代表客戶端模式。需要指定伺服器的IP地址以連接到伺服器端。

```bash
#!/bin/bash
# 壓力測試腳本

# UDP 小包轉發測試
echo "開始UDP小包轉發測試 (64字節)"
iperf3 -c 192.168.20.100 -u -b 100M -l 64

# UDP 大包轉發測試
echo "開始UDP大包轉發測試 (1500字節)"
iperf3 -c 192.168.20.100 -u -b 100M -l 1500

# TCP 小包轉發測試
echo "開始TCP小包轉發測試 (64字節)"
iperf3 -c 192.168.20.100 -l 64

# TCP 大包轉發測試
echo "開始TCP大包轉發測試 (1500字節)"
iperf3 -c 192.168.20.100 -l 1500
```


## 測試結果

### ISP LAN 對虛擬家庭網路測試結果

| Test Type | Packet Size | Protocol | Transfer     | Bitrate         | Bandwidth Set |
|-----------|-------------|----------|--------------|-----------------|---------------|
| TCP小包轉發 | 64 bytes    | TCP      | 43.4 MBytes  | 36.4 Mbits/sec  | N/A           |
| UDP小包轉發 | 64 bytes    | UDP      | 11.9 MBytes  | 9.99 Mbits/sec  | 10M           |
| TCP大包轉發 | 1400 bytes  | TCP      | 571 MBytes   | 478 Mbits/sec   | N/A           |
| UDP大包轉發 | 1400 bytes  | UDP      | 627 MBytes   | 526 Mbits/sec   | 1000M         |

### 虛擬家庭網路間的傳輸測試結果

| Test Type   | Packet Size | Protocol | Transfer     | Bitrate         | Bandwidth Set |
|-------------|-------------|----------|--------------|-----------------|---------------|
| TCP小包轉發 | 64 bytes    | TCP      | 43.3 MBytes  | 36.3 Mbits/sec  | N/A           |
| UDP小包轉發 | 64 bytes    | UDP      | 11.9 MBytes  | 10.0 Mbits/sec  | 10M           |
| TCP大包轉發 | 1400 bytes  | TCP      | 413 MBytes   | 347 Mbits/sec   | N/A           |
| UDP大包轉發 | 1400 bytes  | UDP      | 1005 MBytes  | 843 Mbits/sec   | 1000M         |

### 虛擬家庭網路與虛擬伺服器網路傳輸測試結果（透過軟路由）

| Test Type   | Packet Size | Protocol | Transfer     | Bitrate         | Bandwidth Set |
|-------------|-------------|----------|--------------|-----------------|---------------|
| TCP小包轉發 | 64 bytes    | TCP      | 41.8 MBytes  | 35.1 Mbits/sec  | N/A           |
| UDP小包轉發 | 64 bytes    | UDP      | 11.9 MBytes  | 10.0 Mbits/sec  | 10M           |
| TCP大包轉發 | 1400 bytes  | TCP      | 590 MBytes   | 495 Mbits/sec   | N/A           |
| UDP大包轉發 | 1400 bytes  | UDP      | 980 MBytes   | 822 Mbits/sec   | 1000M         |

## 結論

通過本次測試，我們可以清楚地看到該網絡架構在不同情況下的性能表現。結果表明，雖然該方案在高流量情況下會出現一定的性能瓶頸，但在大多數家庭和中小型辦公室的日常使用中仍然能夠提供穩定且高效的網絡服務。未來，可以根據測試結果進一步優化配置，提升整體網絡效能。

---

希望這篇文章能幫助你更好地理解和評估家庭網絡與伺服器網絡的效能。如果你有任何問題或建議，歡迎在下方留言分享你的想法！